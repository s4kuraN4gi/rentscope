# Cloudflare セットアップガイド

このドキュメントでは、RentScope のドメインを Cloudflare に登録し、DNS を切り替える手順を説明します。
これにより、将来的に自前タイルサーバーを CDN キャッシュしたり、DDoS 保護を受けたりすることが可能になります。

## 1. Cloudflare アカウント作成とドメイン追加

1.  **Cloudflare にアクセス**: [https://www.cloudflare.com/ja-jp/](https://www.cloudflare.com/ja-jp/) を開き、「サインアップ」をクリックします。
2.  **アカウント作成**: メールアドレスとパスワードを入力してアカウントを作成します（既に持っている場合はログイン）。
3.  **サイトを追加（ドメインのオンボーディング）**:
    - ダッシュボードのトップページ、またはアカウントホーム画面に移動します。
    - **「ドメインのオンボーディング (Onboard a domain)」** というボタンまたはリンクをクリックします（2025 年現在、ボタン名が変更されています）。
    - RentScope のドメイン名（例: `rentscope.com`）を入力し、「続行」をクリックします。
4.  **プランの選択**:
    - プラン一覧が表示されます。一番下にある **「Free（無料）」** を選択し、「続行」をクリックします。

## 2. DNS レコードの確認

1.  Cloudflare が現在の DNS 設定を自動的にスキャンします。
2.  スキャン結果が表示されたら、現在設定されているレコード（A レコード、CNAME、MX レコードなど）が正しく取り込まれているか確認します。
    - Vercel を使用している場合、Vercel 関連のレコードが表示されているはずです。
3.  問題なければ「続行」をクリックします。

## 3. ネームサーバーの変更

ここが最も重要なステップです。ドメインの管理権限を現在のレジストラ（お名前.com、GoDaddy、Google Domains など）から Cloudflare に委譲します。

1.  Cloudflare の画面に、**「Cloudflare のネームサーバー」** が 2 つ表示されます（例: `bob.ns.cloudflare.com`, `lola.ns.cloudflare.com`）。この 2 つをメモしてください。
2.  **ドメインレジストラの管理画面**（ドメインを購入したサイト）に別タブでログインします。
3.  対象ドメインの **「ネームサーバー設定」**（または「DNS サーバー変更」）のページを探します。
4.  現在のネームサーバーを削除し、**Cloudflare が指定した 2 つのネームサーバー** に書き換えます。
5.  保存/適用します。

## 4. 設定の完了確認

1.  Cloudflare の画面に戻り、「完了しました、ネームサーバーをチェックしてください」をクリックします。
2.  「クイックスタートガイド」が表示される場合があります。「後で」または推奨設定（HTTPS リライトなど）を有効にして進めます。
3.  **反映待ち**: ネームサーバーの変更が世界中に反映されるまで、数分〜最大 24 時間かかる場合があります。
4.  Cloudflare ダッシュボードで、サイトのステータスが「アクティブ」になれば完了です。

## 5. 推奨設定（完了後）

ステータスが「アクティブ」になったら、以下の設定を確認しておくと良いでしょう。

- **SSL/TLS**: 「Full」または「Full (Strict)」に設定（Vercel は SSL 対応しているため）。
- **Always Online**: オン（サーバーダウン時にキャッシュを表示）。
- **Development Mode**: 開発中はオンにするとキャッシュが無効化され、変更が即座に見えます（通常運用時はオフ）。

---

**次のステップ:**
VPS を構築してタイルサーバーを立ち上げたら、Cloudflare の DNS 設定でサブドメイン（例: `tiles.rentscope.com`）を VPS の IP アドレスに向け、Page Rules でキャッシュ設定を行います（詳細は `OPS_MAP_SETUP.md` 参照）。
