# RentScope プロジェクト概要

## 🎯 目的

- **マップのロード問題を解消**し、ユーザーが「地図を読み込み中…」で止まらないようにする。
- **広告と AI 分析**で収益化し、運営コスト（マップタイル・OpenAI）を上回る黒字化を目指す。
- **ユーザー層**は引越しを検討中の一般ユーザー。課金は最小限に抑え、**AI ボタン**で必要時だけ有料 API を呼び出す設計。

---

## 🏗️ アーキテクチャ構成

```
┌─────────────────────┐
│   ユーザー（PC/スマホ） │
└───────▲───────────────┘
        │
        ▼
┌─────────────────────┐
│  フロントエンド (Next.js)│
│  - SalaryInput          │
│  - AI ボタン (クリック)│
│  - バナー広告 (2 個)   │
│  - Leaflet マップ      │
└───────▲───────────────┘
        │
        ▼
┌─────────────────────┐
│  バックエンド API      │
│  - /api/analyze → OpenAI│
└───────▲───────────────┘
        │
        ▼
┌─────────────────────┐
│  自前タイルサーバー   │
│  (TileServer‑GL on VPS)│
│  - OSM データ → タイル │
│  - 月額 ¥5,000          │
└───────▲───────────────┘
        │
        ▼
┌─────────────────────┐
│  OpenAI (GPT‑3.5‑Turbo)│
│  - 従量課金 ¥0.44/呼び出し│
└─────────────────────┘
```

- **マップタイル**は自前 VPS（TileServer‑GL）で配信し、外部 API コストを **0** に削減。
- **広告**は「通常バナー 2 個（CPM 150 円）」と「AI ボタンクリック時の高単価バナー 1 個（CPM 500 円）」の構成とし、動画広告は廃止。
- **AI**はボタン押下時のみ呼び出し、従量課金は最小限に抑える。

---

### � 収支シミュレーション (広告・AI 最適化版)

**前提条件:**

- **広告範囲**: トップ(2 枠)、都道府県(2 枠)、診断結果(1 枠)、詳細モーダル(1 枠)の全配置を加味。
- **収益単価**:
  - **広告**: 全ページ回遊を考慮し、1PV あたり **¥0.4** と試算。
  - **アフィリエイト**: 診断結果からの成約を見込み、1PV あたり **¥0.3** と試算。
- **AI コスト**: 全アクセスの **40%** が診断を利用する（＝高コスト）ワーストケースで算出。

| 月間 PV       | 広告収益<br>(¥0.4/PV) | アフィリエイト<br>(¥0.3/PV) | AI コスト<br>(40%利用) | サーバー費<br>(VPS+Domain) | **推定利益**  |
| :------------ | :-------------------- | :-------------------------- | :--------------------- | :------------------------- | :------------ |
| **10,000**    | ¥4,000                | ¥3,000                      | -¥1,200                | -¥3,400                    | **+¥2,400**   |
| **50,000**    | ¥20,000               | ¥15,000                     | -¥6,000                | -¥3,400                    | **+¥25,600**  |
| **100,000**   | ¥40,000               | ¥30,000                     | -¥12,000               | -¥3,400                    | **+¥54,600**  |
| **500,000**   | ¥200,000              | ¥150,000                    | -¥60,000               | -¥10,000\*                 | **+¥280,000** |
| **1,000,000** | ¥400,000              | ¥300,000                    | -¥120,000              | -¥15,000\*                 | **+¥565,000** |

<small>\* PV 増大時は VPS をスケールアップして対応</small>

**結論:**
都道府県ページやモーダルへの広告配置により、**10,000 PV という早い段階で黒字化**が見込めます。
さらに、AI コスト（変動費）を上回る収益性（ARPU）が確保できているため、アクセスが増えれば増えるほど利益率が高まる健全な構造です。

---

## 🛡️ デメリットと対策（OPS_MAP_SETUP.md に詳細あり）

| デメリット           | 対策                                                                                 |
| -------------------- | ------------------------------------------------------------------------------------ |
| **VPS 運用手間**     | `cron` で自動 `docker pull` と再起動スクリプトを深夜に実行                           |
| **サーバー負荷**     | Cloudflare CDN でタイルをキャッシュ、PV 500k 超えたら 2 GB/2 CPU にスケールアップ    |
| **OSM データ更新**   | 月 1 回 `planet.osm.pbf` を再取得し、TileServer‑GL に再インポートする cron ジョブ    |
| **障害時タイル欠如** | Cloudflare のキャッシュが残る間は配信可能、予備小規模 VPS をフェイルオーバー用に用意 |
| **セキュリティ**     | SSH 鍵認証のみ、パスワード無効化、`ufw` で 80/443 のみ開放                           |
| **初期設定ハードル** | 公式 Docker イメージ `maptiler/tileserver-gl` を 1 行で起動できるので簡単            |

---

## 📦 実装ステップ概要

1. **VPS と Docker の準備**（`OPS_MAP_SETUP.md` 参照）
2. **OSM データ取得** → `/data/planet.osm.pbf`
3. **TileServer‑GL コンテナ起動**（1 行コマンド）
4. **cron**で自動更新・再起動、OSM データ更新スクリプトを設定
5. **Cloudflare CDN**でタイルキャッシュ設定、Page Rule 作成
6. **フロントエンド**の Leaflet タイル URL を自前サーバーに変更
7. **広告**はバナー 2 個に統一、AI ボタンはクリック時のみ呼び出し
8. **モニタリング**：VPS の CPU/帯域、広告・AI の利用状況を Google Analytics とサーバーログで追跡
9. **スケールアップ**：PV が 500k 超えたら VPS プランを 2 GB/2 CPU に変更（コスト ¥10,000）

---

## 🚀 次のアクション

- **OPS_MAP_SETUP.md** に記載のスクリプトを VPS に配置し、cron を有効化する。
- Cloudflare の DNS と Page Rule を設定し、キャッシュが有効になることを確認。
- フロントエンドの `components/features/AreaMap.tsx` でタイル URL を新しい VPS の URL に差し替える。
- デプロイ後、**Google Analytics** で PV と AI ボタンのクリック率を測定し、シミュレーション通りの収益が出ているか検証。
- 必要に応じて **有料プラン（AI 解析の無制限利用）** を追加し、さらなる収益源を検討。

---

## 📄 参考ファイル

- `OPS_MAP_SETUP.md` – タイルサーバーのセットアップと運用自動化手順
- `implementation_plan.md` – 実装計画（学生モード含む）
- `walkthrough.md` – 完了後の検証手順

---

## 🔮 将来の機能拡張ロードマップ（アイデア）

### 1. 学校名・勤務地検索からのエリア提案

- **概要**: ユーザーが「〇〇大学」や「大手町駅（勤務地）」を入力すると、そこへ通いやすく家賃が手頃なエリアを提案する。
- **技術的要件**:
  - Google Maps API (Places, Directions) の導入が必要。
  - 経路探索（所要時間・乗り換え回数）ロジックの実装。
- **メモ**: ユーザーニーズは非常に高いが、実装コストと API ランニングコストがかかるため、収益化が安定したフェーズでの導入を検討。

---（テストケース、結果のスクリーンショット）

---

**この概要をプロジェクトのルートに `PROJECT_OVERVIEW.md` として保存し、チーム全員で共有してください。**
